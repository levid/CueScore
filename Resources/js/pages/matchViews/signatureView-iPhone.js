// Generated by CoffeeScript 1.3.1
(function() {
  var currentTeamSigning, me, paint;

  me = this;

  currentTeamSigning = null;

  this.signatureViewOverlay = Ti.UI.createView({
    backgroundImage: "images/match/layout/bg-sign-scoresheet-iphone.png",
    height: 301,
    width: 481,
    backgroundColor: "#ffffff",
    visible: false
  });

  this.signatureViewContainer = Ti.UI.createImageView({
    top: 116,
    left: 55,
    height: 40,
    width: 390,
    backgroundColor: "#ffffff"
  });

  this.isSignatureTeamNameTurned = false;

  this.signatureTeamName = Ti.UI.createLabel({
    text: "Team Name",
    top: 50,
    left: 150,
    height: 20,
    width: 220,
    backgroundColor: "transparent",
    textAlign: "left",
    font: {
      fontSize: 15,
      fontWeight: "bold",
      fontFamily: "HelveticaNeue-Bold"
    }
  });

  this.isSignatureTeamNumberTurned = false;

  this.signatureTeamNumber = Ti.UI.createLabel({
    top: 50,
    text: "Team 123",
    left: 80,
    height: 20,
    width: 220,
    backgroundColor: "transparent",
    textAlign: "right",
    font: {
      fontSize: 15,
      fontWeight: "bold",
      fontFamily: "HelveticaNeue-Bold"
    }
  });

  paint = require("ti.paint");

  this.signatureView = paint.createView({
    strokeWidth: 3,
    strokeColor: "#000000",
    height: 40,
    width: 390,
    backgroundColor: "#ffffff"
  });

  this.signatureViewContainer.add(this.signatureView);

  this.signatureBackButton = Ti.UI.createImageView({
    height: 31,
    width: 61,
    top: 8,
    left: 7,
    backgroundColor: "transparent"
  });

  this.signatureBackButton.addEventListener("click", function() {
    return me.hideSignatureView();
  });

  this.signatureNextButton = Ti.UI.createImageView({
    height: 31,
    width: 61,
    top: 8,
    right: 13,
    backgroundColor: "transparent"
  });

  this.signatureNextButton.addEventListener("click", function() {
    return me.setupSignatureOverlay();
  });

  this.signatureSendButton = Ti.UI.createImageView({
    height: 27,
    width: 135,
    top: 250,
    left: 232,
    backgroundColor: "transparent"
  });

  this.signatureSendButton.addEventListener("click", function() {
    var file, theMap, w;
    theMap = me.signatureViewContainer.toImage();
    file = Ti.Filesystem.createTempFile(Ti.Filesystem.resourcesDirectory);
    file.write(theMap);
    w = file.read();
    return DataService.sendSignature(w);
  });

  this.protestMatchButton = Ti.UI.createView({
    height: 27,
    width: 115,
    top: 250,
    left: 111,
    backgroundColor: "transparent"
  });

  this.protestMatchButton.addEventListener("click", function() {
    return me.hideSignatureView();
  });

  this.signatureViewOverlay.add(this.signatureBackButton);

  this.signatureViewOverlay.add(this.signatureNextButton);

  this.signatureViewOverlay.add(this.signatureSendButton);

  this.signatureViewOverlay.add(this.protestMatchButton);

  this.signatureViewOverlay.add(this.signatureViewContainer);

  this.view.add(this.signatureViewOverlay);

  this.openSignatureView = function() {
    me.signatureViewOverlay.visible = true;
    me.matchWindow.orientationModes = [Ti.UI.LANDSCAPE_RIGHT];
    return Ti.UI.orientation = Ti.UI.LANDSCAPE_RIGHT;
  };

  this.hideSignatureView = function() {
    me.signatureViewOverlay.visible = false;
    me.matchWindow.orientationModes = [Ti.UI.PORTRAIT];
    return Ti.UI.orientation = Ti.UI.PORTRAIT;
  };

  this.matchSignedCallBack = function() {
    return me.setupSignatureOverlay();
  };

  this.setupSignatureOverlay = function() {
    this.changeTeamSigning();
    if (this.leagueMatch.HomeTeamNumber === currentTeamSigning) {
      this.signatureTeamName.text = this.leagueMatch.HomeTeamName;
      return this.signatureTeamNumber.text = "Team " + this.leagueMatch.HomeTeamNumber;
    } else if (this.leagueMatch.AwayTeamNumber === currentTeamSigning) {
      this.signatureTeamName.text = this.leagueMatch.AwayTeamName;
      return this.signatureTeamNumber.text = "Team " + this.leagueMatch.AwayTeamNumber;
    } else {

    }
  };

  this.changeTeamSigning = function() {
    if (currentTeamSigning == null) {
      if (this.leagueMatch.HomeTeamSigned === false) {
        return currentTeamSigning = this.leagueMatch.HomeTeamNumber;
      } else {
        if (this.leagueMatch.AwayTeamSigned === false) {
          return currentTeamSigning = this.leagueMatch.AwayTeamNumber;
        }
      }
    } else if (currentTeamSigning === this.leagueMatch.HomeTeamNumber) {
      if (this.leagueMatch.HomeTeamSigned === false) {
        return currentTeamSigning = this.leagueMatch.HomeTeamNumber;
      } else if (this.leagueMatch.AwayTeamSigned === false) {
        return currentTeamSigning = this.leagueMatch.AwayTeamNumber;
      } else {
        return currentTeamSigning = null;
      }
    } else if (currentTeamSigning === this.leagueMatch.AwayTeamNumber) {
      if (this.leagueMatch.AwayTeamSigned === false) {
        return currentTeamSigning = this.leagueMatch.HomeTeamNumber;
      } else if (this.leagueMatch.HomeTeamSigned === false) {
        return currentTeamSigning = this.leagueMatch.AwayTeamNumber;
      } else {
        return currentTeamSigning = null;
      }
    } else {
      if (this.leagueMatch.HomeTeamSigned === false) {
        return currentTeamSigning = this.leagueMatch.HomeTeamNumber;
      } else if (this.leagueMatch.AwayTeamSigned === false) {
        return currentTeamSigning = this.leagueMatch.AwayTeamNumber;
      } else {
        return currentTeamSigning = null;
      }
    }
  };

}).call(this);
