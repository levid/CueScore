<!DOCTYPE html><html><head><title>data_service.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../index.html" class="source"><span class="file_name">README</span></a><a href="../../app.coffee.html" class="source "><span class="base_path">. / </span><span class="file_name">app.coffee</span></a><a href="../../cuescore/api.coffee.html" class="source "><span class="base_path">cuescore / </span><span class="file_name">api.coffee</span></a><a href="../../cuescore/app.coffee.html" class="source "><span class="base_path">cuescore / </span><span class="file_name">app.coffee</span></a><a href="../../cuescore/controllers/dashboard_controller.coffee.html" class="source "><span class="base_path">cuescore / controllers / </span><span class="file_name">dashboard_controller.coffee</span></a><a href="../../cuescore/controllers/match_controller.coffee.html" class="source "><span class="base_path">cuescore / controllers / </span><span class="file_name">match_controller.coffee</span></a><a href="../../cuescore/controllers/match_setup_controller.coffee.html" class="source "><span class="base_path">cuescore / controllers / </span><span class="file_name">match_setup_controller.coffee</span></a><a href="../../cuescore/controllers/play.coffee.html" class="source "><span class="base_path">cuescore / controllers / </span><span class="file_name">play.coffee</span></a><a href="../../cuescore/controllers/posts_controller.coffee.html" class="source "><span class="base_path">cuescore / controllers / </span><span class="file_name">posts_controller.coffee</span></a><a href="../../cuescore/helpers/application.coffee.html" class="source "><span class="base_path">cuescore / helpers / </span><span class="file_name">application.coffee</span></a><a href="../../cuescore/models/eight_ball/eight_ball_game.coffee.html" class="source "><span class="base_path">cuescore / models / eight_ball / </span><span class="file_name">eight_ball_game.coffee</span></a><a href="../../cuescore/models/eight_ball/eight_ball_league.coffee.html" class="source "><span class="base_path">cuescore / models / eight_ball / </span><span class="file_name">eight_ball_league.coffee</span></a><a href="../../cuescore/models/eight_ball/eight_ball_league_match.coffee.html" class="source "><span class="base_path">cuescore / models / eight_ball / </span><span class="file_name">eight_ball_league_match.coffee</span></a><a href="../../cuescore/models/eight_ball/eight_ball_match.coffee.html" class="source "><span class="base_path">cuescore / models / eight_ball / </span><span class="file_name">eight_ball_match.coffee</span></a><a href="../../cuescore/models/eight_ball/eight_ball_player.coffee.html" class="source "><span class="base_path">cuescore / models / eight_ball / </span><span class="file_name">eight_ball_player.coffee</span></a><a href="../../cuescore/models/eight_ball/eight_ball_practice_match.coffee.html" class="source "><span class="base_path">cuescore / models / eight_ball / </span><span class="file_name">eight_ball_practice_match.coffee</span></a><a href="../../cuescore/models/eight_ball/eight_ball_ranks.coffee.html" class="source "><span class="base_path">cuescore / models / eight_ball / </span><span class="file_name">eight_ball_ranks.coffee</span></a><a href="../../cuescore/models/eight_ball/eight_ball_tournament_match.coffee.html" class="source "><span class="base_path">cuescore / models / eight_ball / </span><span class="file_name">eight_ball_tournament_match.coffee</span></a><a href="../../cuescore/models/game.coffee.html" class="source "><span class="base_path">cuescore / models / </span><span class="file_name">game.coffee</span></a><a href="../../cuescore/models/league.coffee.html" class="source "><span class="base_path">cuescore / models / </span><span class="file_name">league.coffee</span></a><a href="../../cuescore/models/leagues/double_jeopardy_league.coffee.html" class="source "><span class="base_path">cuescore / models / leagues / </span><span class="file_name">double_jeopardy_league.coffee</span></a><a href="../../cuescore/models/leagues/doubles_league.coffee.html" class="source "><span class="base_path">cuescore / models / leagues / </span><span class="file_name">doubles_league.coffee</span></a><a href="../../cuescore/models/leagues/masters_league.coffee.html" class="source "><span class="base_path">cuescore / models / leagues / </span><span class="file_name">masters_league.coffee</span></a><a href="../../cuescore/models/leagues/mixed_doubles_league.coffee.html" class="source "><span class="base_path">cuescore / models / leagues / </span><span class="file_name">mixed_doubles_league.coffee</span></a><a href="../../cuescore/models/leagues/womens_league.coffee.html" class="source "><span class="base_path">cuescore / models / leagues / </span><span class="file_name">womens_league.coffee</span></a><a href="../../cuescore/models/match.coffee.html" class="source "><span class="base_path">cuescore / models / </span><span class="file_name">match.coffee</span></a><a href="../../cuescore/models/nine_ball/nine_ball_game.coffee.html" class="source "><span class="base_path">cuescore / models / nine_ball / </span><span class="file_name">nine_ball_game.coffee</span></a><a href="../../cuescore/models/nine_ball/nine_ball_league.coffee.html" class="source "><span class="base_path">cuescore / models / nine_ball / </span><span class="file_name">nine_ball_league.coffee</span></a><a href="../../cuescore/models/nine_ball/nine_ball_league_match.coffee.html" class="source "><span class="base_path">cuescore / models / nine_ball / </span><span class="file_name">nine_ball_league_match.coffee</span></a><a href="../../cuescore/models/nine_ball/nine_ball_match.coffee.html" class="source "><span class="base_path">cuescore / models / nine_ball / </span><span class="file_name">nine_ball_match.coffee</span></a><a href="../../cuescore/models/nine_ball/nine_ball_player.coffee.html" class="source "><span class="base_path">cuescore / models / nine_ball / </span><span class="file_name">nine_ball_player.coffee</span></a><a href="../../cuescore/models/nine_ball/nine_ball_ranks.coffee.html" class="source "><span class="base_path">cuescore / models / nine_ball / </span><span class="file_name">nine_ball_ranks.coffee</span></a><a href="../../cuescore/models/player.coffee.html" class="source "><span class="base_path">cuescore / models / </span><span class="file_name">player.coffee</span></a><a href="../../cuescore/models/post_model.coffee.html" class="source "><span class="base_path">cuescore / models / </span><span class="file_name">post_model.coffee</span></a><a href="../../cuescore/models/rank.coffee.html" class="source "><span class="base_path">cuescore / models / </span><span class="file_name">rank.coffee</span></a><a href="../../cuescore/models/team.coffee.html" class="source "><span class="base_path">cuescore / models / </span><span class="file_name">team.coffee</span></a><a href="../../cuescore/utils/appsync.coffee.html" class="source "><span class="base_path">cuescore / utils / </span><span class="file_name">appsync.coffee</span></a><a href="../../cuescore/utils/base_64.coffee.html" class="source "><span class="base_path">cuescore / utils / </span><span class="file_name">base_64.coffee</span></a><a href="../../cuescore/utils/contains.coffee.html" class="source "><span class="base_path">cuescore / utils / </span><span class="file_name">contains.coffee</span></a><a href="../../cuescore/utils/data_service.coffee.html" class="source selected"><span class="base_path">cuescore / utils / </span><span class="file_name">data_service.coffee</span></a><a href="../../cuescore/utils/device_fix.coffee.html" class="source "><span class="base_path">cuescore / utils / </span><span class="file_name">device_fix.coffee</span></a><a href="../../cuescore/utils/extras.coffee.html" class="source "><span class="base_path">cuescore / utils / </span><span class="file_name">extras.coffee</span></a><a href="../../cuescore/utils/query_string_builder.coffee.html" class="source "><span class="base_path">cuescore / utils / </span><span class="file_name">query_string_builder.coffee</span></a><a href="../../cuescore/utils/template.coffee.html" class="source "><span class="base_path">cuescore / utils / </span><span class="file_name">template.coffee</span></a><a href="../../cuescore/utils/utilities.coffee.html" class="source "><span class="base_path">cuescore / utils / </span><span class="file_name">utilities.coffee</span></a><a href="../../cuescore/views/dashboard/dashboard_view.coffee.html" class="source "><span class="base_path">cuescore / views / dashboard / </span><span class="file_name">dashboard_view.coffee</span></a><a href="../../cuescore/views/dashboard/title_bar_view.coffee.html" class="source "><span class="base_path">cuescore / views / dashboard / </span><span class="file_name">title_bar_view.coffee</span></a><a href="../../cuescore/views/dashboard/tools/activity_view.coffee.html" class="source "><span class="base_path">cuescore / views / dashboard / tools / </span><span class="file_name">activity_view.coffee</span></a><a href="../../cuescore/views/dashboard/tools/events_view.coffee.html" class="source "><span class="base_path">cuescore / views / dashboard / tools / </span><span class="file_name">events_view.coffee</span></a><a href="../../cuescore/views/dashboard/tools/grid_view.coffee.html" class="source "><span class="base_path">cuescore / views / dashboard / tools / </span><span class="file_name">grid_view.coffee</span></a><a href="../../cuescore/views/dashboard/tools/list_view.coffee.html" class="source "><span class="base_path">cuescore / views / dashboard / tools / </span><span class="file_name">list_view.coffee</span></a><a href="../../cuescore/views/dashboard/tools/live_view.coffee.html" class="source "><span class="base_path">cuescore / views / dashboard / tools / </span><span class="file_name">live_view.coffee</span></a><a href="../../cuescore/views/dashboard/tools/menu_view.coffee.html" class="source "><span class="base_path">cuescore / views / dashboard / tools / </span><span class="file_name">menu_view.coffee</span></a><a href="../../cuescore/views/dashboard/tools/news_view.coffee.html" class="source "><span class="base_path">cuescore / views / dashboard / tools / </span><span class="file_name">news_view.coffee</span></a><a href="../../cuescore/views/dashboard/tools/profile_view.coffee.html" class="source "><span class="base_path">cuescore / views / dashboard / tools / </span><span class="file_name">profile_view.coffee</span></a><a href="../../cuescore/views/dashboard/tools/rules_view.coffee.html" class="source "><span class="base_path">cuescore / views / dashboard / tools / </span><span class="file_name">rules_view.coffee</span></a><a href="../../cuescore/views/dashboard/tools/settings_view.coffee.html" class="source "><span class="base_path">cuescore / views / dashboard / tools / </span><span class="file_name">settings_view.coffee</span></a><a href="../../cuescore/views/dashboard/tools/teams_view.coffee.html" class="source "><span class="base_path">cuescore / views / dashboard / tools / </span><span class="file_name">teams_view.coffee</span></a><a href="../../cuescore/views/login/main.coffee.html" class="source "><span class="base_path">cuescore / views / login / </span><span class="file_name">main.coffee</span></a><a href="../../cuescore/views/posts/post_view_controller.coffee.html" class="source "><span class="base_path">cuescore / views / posts / </span><span class="file_name">post_view_controller.coffee</span></a><a href="../../cuescore/views/posts/posts_view_controller.coffee.html" class="source "><span class="base_path">cuescore / views / posts / </span><span class="file_name">posts_view_controller.coffee</span></a><a href="../../cuescore/views/sample/main.coffee.html" class="source "><span class="base_path">cuescore / views / sample / </span><span class="file_name">main.coffee</span></a><a href="../../cuescore/views/settings/main.coffee.html" class="source "><span class="base_path">cuescore / views / settings / </span><span class="file_name">main.coffee</span></a><a href="../../cuescore/window/main.coffee.html" class="source "><span class="base_path">cuescore / window / </span><span class="file_name">main.coffee</span></a><a href="../../cuescore/window/second.coffee.html" class="source "><span class="base_path">cuescore / window / </span><span class="file_name">second.coffee</span></a><a href="../../spec/models/eight_ball/eight_ball_game_spec.coffee.html" class="source "><span class="base_path">spec / models / eight_ball / </span><span class="file_name">eight_ball_game_spec.coffee</span></a><a href="../../spec/models/eight_ball/eight_ball_league_match_spec.coffee.html" class="source "><span class="base_path">spec / models / eight_ball / </span><span class="file_name">eight_ball_league_match_spec.coffee</span></a><a href="../../spec/models/eight_ball/eight_ball_match_spec.coffee.html" class="source "><span class="base_path">spec / models / eight_ball / </span><span class="file_name">eight_ball_match_spec.coffee</span></a><a href="../../spec/models/eight_ball/eight_ball_player_spec.coffee.html" class="source "><span class="base_path">spec / models / eight_ball / </span><span class="file_name">eight_ball_player_spec.coffee</span></a><a href="../../spec/models/eight_ball/eight_ball_ranks_spec.coffee.html" class="source "><span class="base_path">spec / models / eight_ball / </span><span class="file_name">eight_ball_ranks_spec.coffee</span></a><a href="../../spec/models/game_spec.coffee.html" class="source "><span class="base_path">spec / models / </span><span class="file_name">game_spec.coffee</span></a><a href="../../spec/models/league_spec.coffee.html" class="source "><span class="base_path">spec / models / </span><span class="file_name">league_spec.coffee</span></a><a href="../../spec/models/nine_ball/nine_ball_game_spec.coffee.html" class="source "><span class="base_path">spec / models / nine_ball / </span><span class="file_name">nine_ball_game_spec.coffee</span></a><a href="../../spec/models/nine_ball/nine_ball_league_match_spec.coffee.html" class="source "><span class="base_path">spec / models / nine_ball / </span><span class="file_name">nine_ball_league_match_spec.coffee</span></a><a href="../../spec/models/nine_ball/nine_ball_match_spec.coffee.html" class="source "><span class="base_path">spec / models / nine_ball / </span><span class="file_name">nine_ball_match_spec.coffee</span></a><a href="../../spec/models/nine_ball/nine_ball_player_spec.coffee.html" class="source "><span class="base_path">spec / models / nine_ball / </span><span class="file_name">nine_ball_player_spec.coffee</span></a><a href="../../spec/models/nine_ball/nine_ball_ranks_spec.coffee.html" class="source "><span class="base_path">spec / models / nine_ball / </span><span class="file_name">nine_ball_ranks_spec.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>data_service.coffee</h1><div class="filepath">cuescore/utils/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nx">DataService</span> <span class="k">extends</span> <span class="nx">$CS</span><span class="p">.</span><span class="nx">Utilities</span>
  <span class="nv">defaults: </span><span class="p">{}</span>

  <span class="nv">constructor: </span><span class="nf">(options = {}) -&gt;</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">@</span><span class="p">,</span> <span class="nx">@defaults</span>
    
    <span class="nv">email: </span><span class="s">&quot;i.wooten@gmail.com&quot;</span>
    <span class="vi">@db = </span><span class="nx">@openDatabase</span><span class="p">()</span>
    
  <span class="nv">undoMatch: </span><span class="nf">(originalId) -&gt;</span>
    <span class="k">try</span>
      <span class="nv">row = </span><span class="nx">@db</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="s">&quot;SELECT ID,OriginalId,Match FROM Matches WHERE OriginalId = &quot;</span> <span class="o">+</span> <span class="nx">originalId</span> <span class="o">+</span> <span class="s">&quot; OR ID = &quot;</span> <span class="o">+</span> <span class="nx">originalId</span> <span class="o">+</span> <span class="s">&quot; ORDER BY ID DESC LIMIT 1 OFFSET 1&quot;</span><span class="p">)</span>
      <span class="nx">unless</span> <span class="nx">row</span><span class="p">.</span><span class="nx">isValidRow</span><span class="p">()</span>
        <span class="nx">row</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
        <span class="nx">@db</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">null</span>
      <span class="nv">match = </span><span class="p">(</span><span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s">&quot;return&quot;</span> <span class="o">+</span> <span class="nx">row</span><span class="p">.</span><span class="nx">fieldByName</span><span class="p">(</span><span class="s">&quot;Match&quot;</span><span class="p">))())</span>
      <span class="nv">match.OriginalId = </span><span class="nx">originalId</span>
      <span class="nx">@db</span><span class="p">.</span><span class="nx">execute</span> <span class="s">&quot;DELETE FROM Matches WHERE OriginalId = &quot;</span> <span class="o">+</span> <span class="nx">originalId</span> <span class="o">+</span> <span class="s">&quot; AND ID &gt; &quot;</span> <span class="o">+</span> <span class="nx">row</span><span class="p">.</span><span class="nx">fieldByName</span><span class="p">(</span><span class="s">&quot;ID&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; AND ID != OriginalId&quot;</span>
      <span class="nx">row</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
      <span class="nx">@db</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
      <span class="k">return</span> <span class="nx">match</span>
    <span class="k">catch</span> <span class="nx">e</span>
      <span class="nx">row</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
      <span class="nx">@db</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>

  <span class="nv">saveMatch: </span><span class="nf">(match, setOriginalIdCallback) -&gt;</span>
    <span class="k">try</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">match</span><span class="p">.</span><span class="nx">originalId</span><span class="o">?</span> <span class="o">or</span> <span class="nx">match</span><span class="p">.</span><span class="nx">originalId</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nv">leagueMatch.smallJSON = </span><span class="kc">true</span>
        <span class="nx">@db</span><span class="p">.</span><span class="nx">execute</span> <span class="s">&quot;INSERT INTO Matches (Match, EnteredDateTime) VALUES(?, ?)&quot;</span><span class="p">,</span> <span class="nx">@convertToJSONString</span><span class="p">(</span><span class="nx">match</span><span class="p">),</span> <span class="s">&quot;DATETIME(NOW)&quot;</span>
        <span class="nx">setOriginalIdCallback</span> <span class="nx">@db</span><span class="p">.</span><span class="nx">lastInsertRowId</span>
        <span class="nx">@db</span><span class="p">.</span><span class="nx">execute</span> <span class="s">&quot;UPDATE Matches SET OriginalId = &quot;</span> <span class="o">+</span> <span class="nx">@db</span><span class="p">.</span><span class="nx">lastInsertRowId</span> <span class="o">+</span> <span class="s">&quot; WHERE ID = &quot;</span> <span class="o">+</span> <span class="nx">@db</span><span class="p">.</span><span class="nx">lastInsertRowId</span>
        <span class="nx">@db</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
        <span class="k">return</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;@db rounded OId&quot;</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">originalId</span><span class="p">)</span>
      <span class="nx">@db</span><span class="p">.</span><span class="nx">execute</span> <span class="s">&quot;INSERT INTO Matches (OriginalId, Match, EnteredDateTime) VALUES(?, ?, ?)&quot;</span><span class="p">,</span> <span class="nx">match</span><span class="p">.</span><span class="nx">originalId</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="nx">@convertToJSONString</span><span class="p">(</span><span class="nx">match</span><span class="p">),</span> <span class="s">&quot;DATETIME(NOW)&quot;</span>
      <span class="nx">@db</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
      <span class="k">return</span>
    <span class="k">catch</span> <span class="nx">e</span>
      <span class="nx">@db</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span> 

  <span class="nv">getLeagueMatch: </span><span class="nf">(leagueMatchId) -&gt;</span>
    <span class="k">try</span>
      <span class="nv">row = </span><span class="nx">@db</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="s">&quot;SELECT LeagueMatch FROM LeagueMatches WHERE ID = &quot;</span> <span class="o">+</span> <span class="nx">leagueMatchId</span><span class="p">)</span>
      <span class="nv">leagueMatch = </span><span class="p">(</span><span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s">&quot;return&quot;</span> <span class="o">+</span> <span class="nx">row</span><span class="p">.</span><span class="nx">fieldByName</span><span class="p">(</span><span class="s">&quot;LeagueMatch&quot;</span><span class="p">))())</span>
      <span class="nv">leagueMatch.leagueMatchId = </span><span class="nx">leagueMatchId</span>
      <span class="nx">row</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
      <span class="nx">@db</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
      <span class="k">return</span> <span class="nx">leagueMatch</span>
    <span class="k">catch</span> <span class="nx">e</span>
      <span class="nx">row</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
      <span class="nx">@db</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>

  <span class="nv">saveLeagueMatch: </span><span class="nf">(leagueMatch, setLeagueMatchIdCallback) -&gt;</span>
    <span class="k">try</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">log</span> <span class="nx">@convertToJSONString</span><span class="p">(</span><span class="nx">leagueMatch</span><span class="p">)</span>
      <span class="k">if</span> <span class="o">not</span> <span class="nx">leagueMatch</span><span class="p">.</span><span class="nx">leagueMatchId</span><span class="o">?</span> <span class="o">or</span> <span class="nx">leagueMatch</span><span class="p">.</span><span class="nx">leagueMatchId</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="nv">leagueMatch.smallJSON = </span><span class="kc">true</span>
        <span class="nx">@db</span><span class="p">.</span><span class="nx">execute</span> <span class="s">&quot;INSERT INTO LeagueMatches (LeagueMatch, EnteredDateTime) VALUES(?, ?)&quot;</span><span class="p">,</span> <span class="nx">@convertToJSONString</span><span class="p">(</span><span class="nx">leagueMatch</span><span class="p">),</span> <span class="s">&quot;DATETIME(NOW)&quot;</span>
        <span class="nx">setLeagueMatchIdCallback</span> <span class="nx">@db</span><span class="p">.</span><span class="nx">lastInsertRowId</span>
        <span class="nx">@db</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
        <span class="k">return</span>
      <span class="nx">@db</span><span class="p">.</span><span class="nx">execute</span> <span class="s">&quot;UPDATE LeagueMatches SET SET LeagueMatch = &quot;</span> <span class="o">+</span> <span class="nx">@convertToJSONString</span><span class="p">(</span><span class="nx">leagueMatch</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; WHERE ID = &quot;</span> <span class="o">+</span> <span class="nx">leagueMatch</span><span class="p">.</span><span class="nx">leagueMatchId</span>
      <span class="nx">setLeagueMatchIdCallback</span> <span class="nx">@db</span><span class="p">.</span><span class="nx">lastInsertRowId</span>
      <span class="nx">@db</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
      <span class="k">return</span>
    <span class="k">catch</span> <span class="nx">e</span>
      <span class="nx">setLeagueMatchIdCallback</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
      <span class="nx">@db</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span> 

  <span class="nv">sendSignature: </span><span class="nf">(imageData) -&gt;</span>
    <span class="nv">xhr = </span><span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">Network</span><span class="p">.</span><span class="nx">createHTTPClient</span><span class="p">()</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">setTimeout</span> <span class="mi">9999999</span>
    <span class="nv">xhr.onload = </span><span class="o">-&gt;</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;in utf-8 onload for POST&quot;</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">info</span> <span class="nx">@responseText</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">createAlertDialog</span><span class="p">(</span>
        <span class="nv">title: </span><span class="s">&quot;Success:&quot;</span>
        <span class="nv">message: </span><span class="nx">@responseText</span>
      <span class="p">).</span><span class="nx">show</span><span class="p">()</span>

    <span class="nv">xhr.onerror = </span><span class="nf">(e) -&gt;</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;in utf-8 error for POST&quot;</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">info</span> <span class="nx">e</span><span class="p">.</span><span class="nx">error</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">createAlertDialog</span><span class="p">(</span>
        <span class="nv">title: </span><span class="s">&quot;Error:&quot;</span>
        <span class="nv">message: </span><span class="nx">e</span><span class="p">.</span><span class="nx">error</span>
      <span class="p">).</span><span class="nx">show</span><span class="p">()</span>

    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span> <span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="s">&quot;http://cuescoreapp.com/signature/post/&quot;</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span>
      <span class="nv">teamid: </span><span class="s">&quot;new&quot;</span>
      <span class="nv">matchid: </span><span class="s">&quot;new&quot;</span>
      <span class="nv">gametype: </span><span class="kc">null</span>
      <span class="nv">playerid: </span><span class="s">&quot;new&quot;</span>
      <span class="nv">mimetype: </span><span class="s">&quot;png&quot;</span>
      <span class="nv">imagedata: </span><span class="nx">imageData</span><span class="p">.</span><span class="nx">data</span>

  <span class="nv">sendLeagueMatch: </span><span class="nf">(leagueMatch) -&gt;</span>
    <span class="nv">xhr = </span><span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">Network</span><span class="p">.</span><span class="nx">createHTTPClient</span><span class="p">(</span><span class="nv">timeout: </span><span class="mi">9999999999999</span><span class="p">)</span>
    <span class="nv">xhr.onload = </span><span class="o">-&gt;</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;in utf-8 onload for POST&quot;</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">info</span> <span class="nx">@responseText</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">createAlertDialog</span><span class="p">(</span>
        <span class="nv">title: </span><span class="s">&quot;Success:&quot;</span>
        <span class="nv">message: </span><span class="nx">@responseText</span>
      <span class="p">).</span><span class="nx">show</span><span class="p">()</span>

    <span class="nv">xhr.onerror = </span><span class="nf">(e) -&gt;</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;in utf-8 error for POST&quot;</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">API</span><span class="p">.</span><span class="nx">info</span> <span class="nx">e</span><span class="p">.</span><span class="nx">error</span>
      <span class="nx">Ti</span><span class="o">?</span><span class="p">.</span><span class="nx">UI</span><span class="p">.</span><span class="nx">createAlertDialog</span><span class="p">(</span>
        <span class="nv">title: </span><span class="s">&quot;Error:&quot;</span>
        <span class="nv">message: </span><span class="nx">e</span><span class="p">.</span><span class="nx">error</span>
      <span class="p">).</span><span class="nx">show</span><span class="p">()</span>

    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span> <span class="s">&quot;POST&quot;</span><span class="p">,</span> <span class="s">&quot;http://cuescoreapp.com/leaguematch/post/&quot;</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span>
      <span class="nv">userid: </span><span class="s">&quot;123&quot;</span>
      <span class="nv">apikey: </span><span class="s">&quot;secret&quot;</span>
      <span class="nv">format: </span><span class="s">&quot;json&quot;</span>
      <span class="nv">sendToEmail: </span><span class="nx">@email</span>
      <span class="nv">matchid: </span><span class="s">&quot;new&quot;</span>
      <span class="nv">matchdata: </span><span class="nx">@convertToJSONString</span><span class="p">(</span><span class="nx">leagueMatch</span><span class="p">)</span>
      <span class="nv">gametype: </span><span class="nx">@</span><span class="p">.</span><span class="nx">leagueMatch</span><span class="p">.</span><span class="nx">GameType</span>

  <span class="nv">setupLocalDatabase: </span><span class="o">-&gt;</span>
    <span class="vi">@db = </span><span class="nx">@openDatabase</span><span class="p">()</span>
    <span class="nx">@db</span><span class="p">.</span><span class="nx">execute</span> <span class="s">&quot;CREATE TABLE IF NOT EXISTS LeagueMatches (ID INTEGER PRIMARY KEY, LeagueMatch BLOB, Sent BOOLEAN, EnteredDateTime DATETIME)&quot;</span>
    <span class="nx">@db</span><span class="p">.</span><span class="nx">execute</span> <span class="s">&quot;CREATE TABLE IF NOT EXISTS Matches (ID INTEGER PRIMARY KEY, OriginalId Integer, leagueMatchId Integer, Match BLOB, EnteredDateTime DATETIME)&quot;</span>
    <span class="nx">@db</span><span class="p">.</span><span class="nx">execute</span> <span class="s">&quot;DELETE FROM LeagueMatches&quot;</span>
    <span class="nx">@db</span><span class="p">.</span><span class="nx">execute</span> <span class="s">&quot;DELETE FROM Matches&quot;</span>
    <span class="nx">@db</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>

  <span class="nv">openDatabase: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">Ti</span><span class="o">?</span> <span class="k">then</span> <span class="nx">Ti</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">open</span> <span class="s">&quot;CueScore&quot;</span> <span class="k">else</span> <span class="nv">close: </span><span class="o">-&gt;</span>
  <span class="nv">convertToJSONString: </span><span class="nf">(myObject) -&gt;</span>
    <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span> <span class="nx">myObject</span>

  <span class="nv">parseJSONString: </span><span class="nf">(myJSONtext, emptyObject) -&gt;</span>
    <span class="nx">emptyObject</span><span class="p">.</span><span class="nx">fromJSON</span> <span class="nx">myJSONtext</span>

  <span class="nv">var_dump: </span><span class="nf">(obj) -&gt;</span>
    <span class="k">if</span> <span class="k">typeof</span> <span class="nx">obj</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
      <span class="s">&quot;Type: &quot;</span> <span class="o">+</span> <span class="k">typeof</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">)</span> <span class="k">then</span> <span class="s">&quot;\nConstructor: &quot;</span> <span class="o">+</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span> <span class="k">else</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;\nValue: &quot;</span> <span class="o">+</span> <span class="nx">obj</span>
    <span class="k">else</span>
      <span class="s">&quot;Type: &quot;</span> <span class="o">+</span> <span class="k">typeof</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;\nValue: &quot;</span> <span class="o">+</span> <span class="nx">obj</span>
      
<span class="nv">$CS.Utilities.DataService = </span><span class="nx">DataService</span>

</pre></div></td></tr></tbody></table><div id="projectname"><a href="../../index.html">CueScore Mobile</a></div></div></body></html>